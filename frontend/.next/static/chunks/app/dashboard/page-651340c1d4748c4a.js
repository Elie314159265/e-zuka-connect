(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{9513:function(e,s,t){Promise.resolve().then(t.bind(t,4285))},4285:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return S}});var a=t(7437),l=t(2265),n=t(6349),r=t(7138),i=t(6127),c=t(8296),d=t(2461),o=t(3907),x=t(5231),h=t(9849),m=t(4142),j=t(2842),u=t(9057),g=t(560),p=t(4015),y=t(459),f=t(7948),N=t(6923),v=t(8295),b=t(4446),w=t(4697),k=t(357);function _(e){let{isOpen:s,onClose:t}=e,[r,i]=(0,l.useState)(!1),[c,d]=(0,l.useState)(""),[x,h]=(0,l.useState)(""),m=async()=>{i(!0),d(""),h("");try{var e,s,t,a,l;let n=k.env.NEXT_PUBLIC_GEMINI_API_KEY;if(!n){console.warn("NEXT_PUBLIC_GEMINI_API_KEY is not set. Using mock data."),d("AIアドバイスのデモです:\n\n1. **雨の日限定セット割:** 雨の日は客足が遠のくようですので、「からあげ弁当 + 温かいお茶」のセットを50円引きで提供してみてはいかがでしょうか。\n\n2. **ランチタイムの看板:** お店の前を通るサラリーマン向けに、日替わり定食の内容を写真付きでアピールする看板を出すと効果的です。\n\n3. **ポイントカード導入:** 地元の常連さん向けに、500円で1ポイント貯まり、20ポイントでからあげ1個サービスのようなポイントカードを始めると、再来店に繋がりますよ！"),i(!1);return}let r=await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=".concat(n),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{role:"user",parts:[{text:"あなたは福岡県飯塚市にある個人商店の、親しみやすく励ましてくれる経営コンサルタントです。以下のデータに基づき、売上を向上させるための具体的で分かりやすい行動案を3つ提案してください。日本語で、箇条書きや番号付きリストを使って回答をフ���ーマットしてください。データ: [売上傾向: 今月は微減。天気の影響: 雨の日に売上が落ちる。人気商品: 1. 特製からあげ弁当, 2. 日替わり定食, 3. チキン南蛮。主な客層: サラリーマンや地元住民。]"}]}]})});if(!r.ok){let e=await r.text();throw console.error("API Error Response:",e),Error("API request failed with status ".concat(r.status))}let c=await r.json();if(null===(l=c.candidates)||void 0===l?void 0:null===(a=l[0])||void 0===a?void 0:null===(t=a.content)||void 0===t?void 0:null===(s=t.parts)||void 0===s?void 0:null===(e=s[0])||void 0===e?void 0:e.text){let e=c.candidates[0].content.parts[0].text;d(e)}else throw console.error("Unexpected API response format:",c),Error("AIからの応答が予期した形式ではありません。")}catch(e){console.error("Error calling Gemini API:",e),h("AIからのアドバイスの取得に失敗しました。APIキーが正しく設定されているか確認してください。")}finally{i(!1)}};return(0,l.useEffect)(()=>{s&&m()},[s]),(0,a.jsx)(b.M,{children:s&&(0,a.jsx)(n.E.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:t,className:"fixed inset-0 bg-black/60 z-[110] flex items-center justify-center p-4 backdrop-blur-sm",children:(0,a.jsxs)(n.E.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},transition:{type:"spring",stiffness:300,damping:30},onClick:e=>e.stopPropagation(),className:"bg-white rounded-2xl shadow-lg max-w-2xl w-full p-8 relative",children:[(0,a.jsx)("button",{onClick:t,className:"absolute top-4 right-4 text-gray-400 hover:text-gray-600",children:(0,a.jsx)(w.Z,{className:"w-6 h-6"})}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(o.Z,{className:"w-12 h-12 text-purple-500 mx-auto mb-4"}),(0,a.jsx)("h2",{className:"text-2xl font-bold mb-4",children:"AI経営アドバイザーからの提案"})]}),(0,a.jsxs)("div",{className:"mt-6 text-left max-h-[60vh] overflow-y-auto pr-4 text-gray-700 space-y-4",children:[r&&(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center h-48",children:[(0,a.jsx)(n.E.div,{animate:{rotate:360},transition:{repeat:1/0,duration:1,ease:"linear"},className:"w-10 h-10 border-4 border-purple-500 border-t-transparent rounded-full"}),(0,a.jsx)("p",{className:"mt-4 text-gray-500",children:"AIが分析中です..."})]}),x&&(0,a.jsx)("p",{className:"text-red-500 text-center",children:x}),c&&(0,a.jsx)("div",{className:"prose max-w-none whitespace-pre-wrap",children:c})]})]})})})}var I=t(8320);let E={initial:{opacity:0,y:20},in:{opacity:1,y:0},out:{opacity:0,y:-20}},A={type:"tween",ease:"anticipate",duration:.5};function S(){let[e,s]=(0,l.useState)(!1),[t,b]=(0,l.useState)(null),[w,k]=(0,l.useState)([]),[S,P]=(0,l.useState)({age:[],gender:[]}),[C,F]=(0,l.useState)(!0),[K,L]=(0,l.useState)(null),{token:Z}=(0,I.t)();(0,l.useEffect)(()=>{(async()=>{if(!Z){L("認証トークンがありません。再度ログインしてください。"),F(!1);return}try{let e="http://localhost:8000",[s,t,a]=await Promise.all([fetch("".concat(e,"/api/analysis/sales-by-weather"),{headers:{Authorization:"Bearer ".concat(Z)}}),fetch("".concat(e,"/api/analysis/daily-sales?days=7"),{headers:{Authorization:"Bearer ".concat(Z)}}),fetch("".concat(e,"/api/analysis/customer-demographics"),{headers:{Authorization:"Bearer ".concat(Z)}})]);if(!s.ok||!t.ok||!a.ok){let e=[s,t,a].find(e=>!e.ok),l=e?await e.json():{detail:"データの取得に失敗しました。"};throw Error(l.detail)}let l=await s.json(),n=await t.json(),r=await a.json();b(l),k(n.map(e=>({...e,date:new Date(e.date).toLocaleDateString("ja-JP",{month:"numeric",day:"numeric"})}))),P({age:r.age_demographics,gender:r.gender_demographics})}catch(e){L(e instanceof Error?e.message:"不明なエラーが発生しました。")}finally{F(!1)}})()},[Z]);let B=e=>{let{data:s,title:t}=e,l=["#0088FE","#00C49F","#FFBB28","#FF8042","#AF19FF"];return C?(0,a.jsx)("div",{className:"h-40 bg-gray-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)("p",{className:"text-gray-400",children:"グラフを読み込み中..."})}):K?(0,a.jsxs)("div",{className:"h-40 bg-red-50 rounded-lg flex items-center justify-center text-red-600",children:[(0,a.jsx)(i.Z,{className:"w-8 h-8 mr-2"}),(0,a.jsx)("p",{children:"失敗"})]}):s.length>0?(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-semibold text-center mb-2",children:t}),(0,a.jsx)(x.h,{width:"100%",height:150,children:(0,a.jsxs)(f.u,{children:[(0,a.jsx)(N.b,{data:s,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:60,fill:"#8884d8",label:!0,children:s.map((e,s)=>(0,a.jsx)(v.b,{fill:l[s%l.length]},"cell-".concat(s)))}),(0,a.jsx)(g.u,{})]})})]}):(0,a.jsx)("div",{className:"h-40 bg-gray-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)("p",{className:"text-gray-400",children:"データがありません。"})})};return(0,a.jsxs)(n.E.div,{className:"min-h-screen bg-gray-100 py-24",initial:"initial",animate:"in",exit:"out",variants:E,transition:A,children:[(0,a.jsxs)("div",{className:"container mx-auto px-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold",children:"経営ダッシュボード"}),(0,a.jsx)(r.default,{href:"/",className:"text-sm text-gray-500 hover:text-gray-700",children:"トップページに戻る"})]}),(0,a.jsx)("div",{className:"text-center mb-8",children:(0,a.jsxs)(n.E.button,{onClick:()=>s(!0),whileHover:{scale:1.05},whileTap:{scale:.95},className:"bg-gradient-to-r from-purple-500 to-indigo-600 text-white font-bold py-3 px-6 rounded-full focus:outline-none focus:shadow-outline transition-all shadow-lg hover:shadow-xl flex items-center justify-center mx-auto",children:[(0,a.jsx)(o.Z,{className:"w-5 h-5 mr-2"}),"AIによる経営アドバイス ✨"]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,a.jsxs)("div",{className:"lg:col-span-2 space-y-8",children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-md",children:[(0,a.jsx)("h3",{className:"font-bold text-xl mb-4",children:"売上推移（直近7日間）"}),(0,a.jsx)(()=>C?(0,a.jsx)("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)("p",{className:"text-gray-400",children:"グラフを読み込み中..."})}):K?(0,a.jsxs)("div",{className:"h-64 bg-red-50 rounded-lg flex items-center justify-center text-red-600",children:[(0,a.jsx)(i.Z,{className:"w-8 h-8 mr-2"}),(0,a.jsx)("p",{children:"グラフの表示に失敗しました。"})]}):w.length>0?(0,a.jsx)(x.h,{width:"100%",height:350,children:(0,a.jsxs)(h.w,{data:w,margin:{top:5,right:20,left:-10,bottom:5},children:[(0,a.jsx)(m.q,{strokeDasharray:"3 3"}),(0,a.jsx)(j.K,{dataKey:"date"}),(0,a.jsx)(u.Q,{yAxisId:"sales",orientation:"left"}),(0,a.jsx)(u.Q,{yAxisId:"temp",orientation:"right"}),(0,a.jsx)(g.u,{formatter:(e,s)=>"売上"===s?["\xa5".concat(null==e?void 0:e.toLocaleString()),s]:"最高気温"===s||"最低気温"===s?["".concat(e,"\xb0C"),s]:[e,s]}),(0,a.jsx)(p.D,{}),(0,a.jsx)(y.x,{yAxisId:"sales",type:"monotone",dataKey:"total_sales",name:"売上",stroke:"#8884d8",strokeWidth:3}),(0,a.jsx)(y.x,{yAxisId:"temp",type:"monotone",dataKey:"temperature_max",name:"最高気温",stroke:"#ff7300",strokeWidth:2,strokeDasharray:"5 5"}),(0,a.jsx)(y.x,{yAxisId:"temp",type:"monotone",dataKey:"temperature_min",name:"最低気温",stroke:"#82ca9d",strokeWidth:2,strokeDasharray:"5 5"})]})}):(0,a.jsx)("div",{className:"h-64 bg-gray-100 rounded-lg flex items-center justify-center",children:(0,a.jsx)("p",{className:"text-gray-400",children:"売上データがありません。"})}),{})]}),(0,a.jsxs)("div",{className:"grid md:grid-cols-2 gap-8",children:[(0,a.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-md",children:[(0,a.jsx)("h3",{className:"font-bold text-xl mb-4",children:"天気と売上"}),(0,a.jsx)(()=>C?(0,a.jsx)("div",{className:"text-center text-gray-500",children:"分析データを読み込み中..."}):K?(0,a.jsxs)("div",{className:"flex items-center text-red-600",children:[(0,a.jsx)(i.Z,{className:"w-6 h-6 mr-2"}),(0,a.jsx)("p",{children:K})]}):t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(c.Z,{className:"w-12 h-12 text-yellow-500"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-gray-500",children:["晴れの日 (",t.sunny_days_count,"日間) の平均売上"]}),(0,a.jsxs)("p",{className:"text-2xl font-bold",children:["\xa5",Math.round(t.sunny_days_sales).toLocaleString()]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 mt-4",children:[(0,a.jsx)(d.Z,{className:"w-12 h-12 text-blue-500"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("p",{className:"text-gray-500",children:["雨の日 (",t.rainy_days_count,"日間) の平均売上"]}),(0,a.jsxs)("p",{className:"text-2xl font-bold",children:["\xa5",Math.round(t.rainy_days_sales).toLocaleString()]})]})]})]}):(0,a.jsx)("div",{className:"text-center text-gray-500",children:"分析データがありません。"}),{})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-md",children:[(0,a.jsx)("h3",{className:"font-bold text-xl mb-4",children:"主な客層"}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsx)(B,{data:S.age,title:"年代"}),(0,a.jsx)(B,{data:S.gender,title:"性別"})]})]})]})]}),(0,a.jsxs)("div",{className:"bg-white p-6 rounded-xl shadow-md",children:[(0,a.jsx)("h3",{className:"font-bold text-xl mb-4",children:"人気商品ランキング"}),(0,a.jsxs)("ul",{className:"space-y-4",children:[(0,a.jsxs)("li",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-lg font-bold text-yellow-500 mr-4",children:"1."}),(0,a.jsx)("span",{className:"text-gray-700",children:"特製からあげ弁当"})]}),(0,a.jsxs)("li",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-lg font-bold text-gray-400 mr-4",children:"2."}),(0,a.jsx)("span",{className:"text-gray-700",children:"日替わり定食"})]}),(0,a.jsxs)("li",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-lg font-bold text-orange-400 mr-4",children:"3."}),(0,a.jsx)("span",{className:"text-gray-700",children:"チキン南蛮"})]}),(0,a.jsxs)("li",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-lg font-bold text-gray-500 mr-4",children:"4."}),(0,a.jsx)("span",{className:"text-gray-700",children:"手作りコロッケ"})]}),(0,a.jsxs)("li",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"text-lg font-bold text-gray-500 mr-4",children:"5."}),(0,a.jsx)("span",{className:"text-gray-700",children:"かしわおにぎり"})]})]})]})]})]}),(0,a.jsx)(_,{isOpen:e,onClose:()=>s(!1)})]})}},8320:function(e,s,t){"use strict";t.d(s,{t:function(){return n}});var a=t(903),l=t(9291);let n=(0,a.U)()((0,l.tJ)((e,s)=>({token:null,setToken:s=>e({token:s}),isLoggedIn:()=>!!s().token}),{name:"auth-storage",storage:(0,l.FL)(()=>sessionStorage)}))}},function(e){e.O(0,[349,138,814,971,23,744],function(){return e(e.s=9513)}),_N_E=e.O()}]);